<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>JSä¸­applyã€callå’Œbindçš„å®šä¹‰å’Œä½¿ç”¨ - Cirplan</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="cirplan"><meta name=description content="JSä¸­applyã€callå’Œbindçš„å®šä¹‰å’Œä½¿ç”¨"><meta name=keywords content="js,apply,call,bind"><link rel=canonical href=https://cirplan.github.io/post/2016/01-28-apply-call/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link href=/sass/main.min.4325dd250c3d3e29d579a819f16fd876adbc5a03b3a1b32d2eefe0a067e8f219.css rel=stylesheet><meta property="og:title" content="JSä¸­applyã€callå’Œbindçš„å®šä¹‰å’Œä½¿ç”¨"><meta property="og:description" content="JSä¸­applyã€callå’Œbindçš„å®šä¹‰å’Œä½¿ç”¨"><meta property="og:type" content="article"><meta property="og:url" content="https://cirplan.github.io/post/2016/01-28-apply-call/"><meta property="article:section" content="post"><meta property="article:published_time" content="2016-01-28T22:04:28+08:00"><meta property="article:modified_time" content="2016-01-28T22:04:28+08:00"><meta itemprop=name content="JSä¸­applyã€callå’Œbindçš„å®šä¹‰å’Œä½¿ç”¨"><meta itemprop=description content="JSä¸­applyã€callå’Œbindçš„å®šä¹‰å’Œä½¿ç”¨"><meta itemprop=datePublished content="2016-01-28T22:04:28+08:00"><meta itemprop=dateModified content="2016-01-28T22:04:28+08:00"><meta itemprop=wordCount content="3050"><meta itemprop=keywords content="js,apply,call,bind,"><meta name=twitter:card content="summary"><meta name=twitter:title content="JSä¸­applyã€callå’Œbindçš„å®šä¹‰å’Œä½¿ç”¨"><meta name=twitter:description content="JSä¸­applyã€callå’Œbindçš„å®šä¹‰å’Œä½¿ç”¨"></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Cirplan</a></div><div class=mobile-navbar-icon id=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>ä¸»é¡µ</li></a><a href=/post/><li class=mobile-menu-item>å½’æ¡£</li></a><a href=/tags/><li class=mobile-menu-item>æ ‡ç­¾</li></a><a href=/categories/><li class=mobile-menu-item>åˆ†ç±»</li></a><a href=/about/><li class=mobile-menu-item>å…³äº</li></a><a href=https://github.com/cirplan><li class=mobile-menu-item>Github</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Cirplan</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>ä¸»é¡µ</a></li><li class=menu-item><a class=menu-item-link href=/post/>å½’æ¡£</a></li><li class=menu-item><a class=menu-item-link href=/tags/>æ ‡ç­¾</a></li><li class=menu-item><a class=menu-item-link href=/categories/>åˆ†ç±»</a></li><li class=menu-item><a class=menu-item-link href=/about/>å…³äº</a></li><li class=menu-item><a class=menu-item-link href=https://github.com/cirplan>Github</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>JSä¸­applyã€callå’Œbindçš„å®šä¹‰å’Œä½¿ç”¨</h1><div class=post-meta><span class=post-time>2016-01-28</span><div class=post-category><a href=/categories/js/>js</a></div><span class=more-meta>çº¦ 3050 å­—</span>
<span class=more-meta>é¢„è®¡é˜…è¯» 7 åˆ†é’Ÿ</span></div></header><div class=post-outdated><div class=warn><p>ã€æ³¨æ„ã€‘æœ€åæ›´æ–°äº <span class=timeago datetime=2016-01-28T22:04:28 title=2016-01-28>2016-01-28, </span>ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚</p></div></div><div class=post-content><p>æœ¬æ¥æ²¡æ‰“ç®—æƒ³å†™è¿™ä¸ªçš„ï¼Œå› ä¸ºä¸€ç›´è§‰å¾— apply å’Œ call æŒºç®€å•çš„ï¼Œä¸å°±æ˜¯æ”¹å˜è¿è¡Œä¸Šä¸‹æ–‡å˜›ã€‚ç„¶å apply å’Œ call åªæ˜¯å‚æ•°æ¥å—çš„æ–¹å¼ä¸åŒè€Œå·²ã€‚</p><p>ä½†åœ¨ç”¨çš„æ—¶å€™ï¼Œæ€»æ˜¯ä¼šæœ‰ç‚¹é—®é¢˜ï¼Œå›§ã€‚åº”è¯¥æ˜¯æ²¡ç†è§£é€å§ï¼Œæ‰€ä»¥å†ç¢ç£¨ç¢ç£¨ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸‹ã€‚</p><h2 id=1-call-è§„èŒƒ1>1. call <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call>è§„èŒƒ</a></h2><h3 id=11-å®šä¹‰>1.1 å®šä¹‰</h3><pre><code>The call() method calls a function with a given this value and arguments provided individually.
</code></pre><p>call æ–¹æ³•é€šè¿‡ç»™å®šçš„ this value å’Œä¸€ç³»åˆ—çš„å‚æ•°ï¼Œæ¥è°ƒç”¨å‡½æ•°ã€‚</p><h3 id=12-syntax-è¯­æ³•>1.2 Syntax è¯­æ³•</h3><p><code>fun.call(thisArg[, arg1[, arg2[, ...]]])</code></p><h4 id=121-parameters-å‚æ•°>1.2.1 Parameters å‚æ•°</h4><p><strong>thisArg</strong></p><pre><code>The value of this provided for the call to fun. Note that this may not be the actual value seen by the method: if the method is a function in non-strict mode code, null and undefined will be replaced with the global object and primitive values will be converted to objects.
</code></pre><p>å‡½æ•°è¿è¡Œæ—¶çš„ this å€¼ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰å¯èƒ½ä½ çœ‹åˆ°çš„å€¼å¹¶ä¸æ˜¯å‡½æ•°å®é™…æ‰§è¡Œçš„å€¼ï¼šå¦‚æœå‡½æ•°æ˜¯åœ¨<code>éä¸¥æ ¼æ¨¡å¼</code>ä¸‹ï¼ŒæŒ‡å®šä¸º null æˆ– undefined çš„ this å€¼ä¼šè¢«æ›¿æ¢æˆå…¨å±€å¯¹è±¡ï¼Œ
åŸå§‹å€¼ï¼ˆæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”å€¼ï¼‰ä¼šè¢«è½¬ä¸ºå¯¹è±¡ã€‚çœ‹æµ‹è¯•ä»£ç ï¼ˆå¯ä»¥ç›´æ¥ç²˜åˆ°æ§åˆ¶å°æ‰§è¡Œï¼‰ï¼š</p><pre><code>// 1. éä¸¥æ ¼æ¨¡å¼
// 1.1 null
function log () {
    console.log('line1', this);
    console.log('line2', window === this);
}

log.call(null);
// line1 Window {top: Window, location: Location, document: document, window: Window, external: Objectâ€¦}
// line2 true

// 1.2 undefined
log.call(undefined);
// line1 Window {top: Window, location: Location, document: document, window: Window, external: Objectâ€¦}
// line2 true

// 1.3 number
function log () {
    console.log('line1', this);
    console.log('line2', this instanceof Number);
}

log.call(1);
// line1 Number {[[PrimitiveValue]]: 1}
// line2 true

// 1.4 string
function log () {
    console.log('line1', this);
    console.log('line2', this instanceof String);
}

log.call('str');
// line1 String {0: &quot;s&quot;, 1: &quot;t&quot;, 2: &quot;r&quot;, length: 3, [[PrimitiveValue]]: &quot;str&quot;}
// line2 true

1.5 boolbean
function log () {
    console.log('line1', this);
    console.log('line2', this instanceof Boolean);
}

log.call(true);
// line1 Boolean {[[PrimitiveValue]]: true}
// line2 true

///////////////////////////////////////////////////////////////////////////////

// 2. ä¸¥æ ¼æ¨¡å¼ï¼Œthis ä¸ºæŒ‡å®šå€¼
(function () {
    &quot;use strict&quot;;

    function say () {
        console.log(this);
    }

    say.call(null);

})();
// null
</code></pre><p><strong>arg1, arg2, &mldr;</strong></p><pre><code>Arguments for the object.
</code></pre><p>æ–¹æ³•çš„å‚æ•°ã€‚</p><h3 id=13-description-æè¿°>1.3 Description æè¿°</h3><pre><code>A different this object can be assigned when calling an existing function. this refers to the current object, the calling object. With call, you can write a method once and then inherit it in another object, without having to rewrite the method for the new object.
</code></pre><p>æ–¹æ³•å¯ä»¥è¢«ä¸åŒçš„å¯¹è±¡è°ƒç”¨ã€‚this ä¼šè¢«æŒ‡å®šä¸ºå½“å‰è°ƒç”¨å¯¹è±¡ã€‚é€šè¿‡ call ï¼Œä½ åªéœ€è¦å†™ä¸€æ¬¡æ–¹æ³•ï¼Œå°±å¯ä»¥è¢«å…¶ä»–å¯¹è±¡ç»§æ‰¿ï¼Œè€Œä¸éœ€è¦ä¸ºæ–°å¯¹è±¡é‡å†™æ–¹æ³•ã€‚</p><h3 id=14-examples-ä¾‹å­>1.4 Examples ä¾‹å­</h3><p><strong>1.4.1 Using call to chain constructors for an object.</strong></p><p>è®©å¯¹è±¡é“¾æ¥æ„é€ å‡½æ•°ï¼ˆå¥½åˆ«æ‰­ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿™æ ·ç¿»è¯‘ï¼‰ï¼Ÿ</p><pre><code>function Product(name, price) {
  this.name = name;
  this.price = price;

  if (price &lt; 0) {
    throw RangeError('Cannot create product ' +
                      this.name + ' with a negative price');
  }
}

function Food(name, price) {
  Product.call(this, name, price);
  this.category = 'food';
}

function Toy(name, price) {
  Product.call(this, name, price);
  this.category = 'toy';
}

var cheese = new Food('feta', 5);
var fun = new Toy('robot', 40);
// Food {name: &quot;feta&quot;, price: 5, category: &quot;food&quot;}
// Toy {name: &quot;robot&quot;, price: 40, category: &quot;toy&quot;}
</code></pre><p>ä½œç”¨ï¼šå¤åˆ¶æ„é€ å‡½æ•°çš„å±æ€§ï¼Œæ–¹æ³•ã€‚</p><p>é‚£ä¹ˆèƒ½ä¸èƒ½è·å¾—æ„é€ å‡½æ•°<strong>åŸå‹</strong>ä¸Šçš„å±æ€§å’Œæ–¹æ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šä¸è¡Œçš„ï¼Œå› ä¸ºæ²¡æœ‰åŸå‹é“¾ã€‚è¿™ä¸€ç‚¹è¦è°¨è®°ã€‚</p><pre><code>function Product(name, price) {
  this.name = name;
  this.price = price;

  if (price &lt; 0) {
    throw RangeError('Cannot create product ' +
                      this.name + ' with a negative price');
  }
}

Product.prototype.sayName = function () {
    console.log(this.name);
}

function Food(name, price) {
  Product.call(this, name, price);
  this.category = 'food';
}

var cheese = new Food('feta', 5);
cheese.sayName();
</code></pre><p><img src=/post/2016/images/20160128call/call_error.png alt=call_error></p><p><strong>1.4.2 Using call to invoke an anonymous function.</strong></p><p>é€šè¿‡ call æ¥è°ƒç”¨åŒ¿åå‡½æ•°ã€‚</p><pre><code>var animals = [
  { species: 'Lion', name: 'King' },
  { species: 'Whale', name: 'Fail' }
];

for (var i = 0; i &lt; animals.length; i++) {
  (function(i) {
    this.print = function() {
      console.log('#' + i + ' ' + this.species
                  + ': ' + this.name);
    }
    this.print();
  }).call(animals[i], i);
}
// #0 Lion: King
// #1 Whale: Fail
</code></pre><p><strong>1.4.3 Using call to invoke a function and specifying the context for &rsquo;this&rsquo;.</strong></p><p>é€šè¿‡ call æ¥è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶æŒ‡å®šä¸Šä¸‹æ–‡ thisã€‚</p><pre><code>function greet() {
  var reply = [this.person, 'Is An Awesome', this.role].join(' ');
  console.log(reply);
}

var i = {
  person: 'Douglas Crockford', role: 'Javascript Developer'
};

greet.call(i); // Douglas Crockford Is An Awesome Javascript Developer
</code></pre><h2 id=2-apply-è§„èŒƒ2>2. apply <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply>è§„èŒƒ</a></h2><p>apply çš„ä½œç”¨å’Œ call ä¸€æ ·ï¼Œåªæ˜¯åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¼ å‚æ•°çš„æ–¹å¼ä¸åŒã€‚call ä¸­çš„å‚æ•°è¦ä¸€ä¸ªä¸€ä¸ªæŒ‰ä¼ è¿›æ¥ï¼Œè€Œ apply ä¸­çš„å‚æ•°æ˜¯æ•°ç»„çš„å½¢å¼ã€‚</p><h3 id=21-syntax-è¯­æ³•>2.1 Syntax è¯­æ³•</h3><pre><code>fun.apply(thisArg, [argsArray])
</code></pre><h3 id=22-examples-ä¾‹å­>2.2 Examples ä¾‹å­</h3><p>å› ä¸ºå’Œ call å¤ªç›¸ä¼¼ï¼Œè¿™é‡Œä¸»è¦çœ‹çœ‹ä¾‹å­ï¼Œæ„Ÿå—ä¸‹ä¸åŒä¹‹å¤„ã€‚</p><p><strong>2.2.1 Using apply to chain constructors.</strong></p><p>ä½¿ç”¨ apply é“¾æ„é€ å‡½æ•°ã€‚</p><pre><code>Function.prototype.construct = function (aArgs) {
  var oNew = Object.create(this.prototype);
  this.apply(oNew, aArgs);
  return oNew;
};

function MyConstructor() {
  for (var nProp = 0; nProp &lt; arguments.length; nProp++) {
    this['property' + nProp] = arguments[nProp];
  }
}

var myArray = [4, 'Hello world!', false];
var myInstance = MyConstructor.construct(myArray);

console.log(myInstance.property1);                // logs 'Hello world!'
console.log(myInstance instanceof MyConstructor); // logs 'true'
console.log(myInstance.constructor);     
</code></pre><p><em><em>2.2.2 Using apply and built-in functions</em>.</em>*</p><p>é€šè¿‡ apply ä½¿ç”¨å†…ç½®å‡½æ•°ã€‚è¿™ä¸ªä¸»è¦æ˜¯ Math.max / Math.min ä¹‹ç±»çš„å†…ç½®å‡½æ•°ã€‚</p><pre><code>// min/max number in an array
var numbers = [5, 6, 2, 3, 7];

// using Math.min/Math.max apply
var max = Math.max.apply(null, numbers); 
// This about equal to Math.max(numbers[0], ...)
// or Math.max(5, 6, ...)

var min = Math.min.apply(null, numbers);

// vs. simple loop based algorithm å¯¹æ¯”å¾ªç¯æ–¹å¼
max = -Infinity, min = +Infinity;

for (var i = 0; i &lt; numbers.length; i++) {
  if (numbers[i] &gt; max) {
    max = numbers[i];
  }
  if (numbers[i] &lt; min) {
    min = numbers[i];
  }
}
</code></pre><p><strong>2.2.3 Using apply in &ldquo;monkey-patching&rdquo;</strong></p><p>ç”¨äºçŒ´å­è¡¥ä¸ï¼ˆwhatï¼‰ï¼Ÿç”¨åœ¨å“ªé‡Œï¼Ÿè§£æè¯´è¿™æ˜¯ä¸€ç§hackã€‚</p><pre><code>var originalfoo = someobject.foo;
someobject.foo = function() {
  // Do stuff before calling function
  console.log(arguments);
  // Call the function as it would have been called normally:
  originalfoo.apply(this, arguments);
  // Run stuff after, here.
}
</code></pre><h2 id=3-bind-è§„èŒƒ3>3. bind <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind>è§„èŒƒ</a></h2><p>bind æ˜¯ ES5 ä¸­æ–°å¢çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¹Ÿæ˜¯æ”¹å˜è¿è¡Œçš„ä¸Šä¸‹æ–‡ã€‚é‚£ä¹ˆä¸ call å’Œ apply æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹ï½</p><h3 id=31-å®šä¹‰>3.1 å®šä¹‰</h3><pre><code>The bind() method creates a new function that, when called, has its this keyword set to the provided value, with a given sequence of arguments preceding any provided when the new function is called.
</code></pre><p>bind æ–¹æ³•åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šæ–°å»ºä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°ä¸º value å’Œä¸€äº›åˆ—æä¾›çš„å‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œthis ä¼šè®¾ç½®ä¸ºå‚æ•°ä¸­çš„ valueï¼ˆä¸€ç›´ç¿»çš„ä¸é€šé¡ºï¼‰ã€‚</p><h3 id=32-syntax-è¯­æ³•>3.2 Syntax è¯­æ³•</h3><p><code>fun.bind(thisArg[, arg1[, arg2[, ...]]])</code></p><h4 id=321-parameters-å‚æ•°>3.2.1 Parameters å‚æ•°</h4><p><strong>thisArg</strong></p><pre><code>The value to be passed as the this parameter to the target function when the bound function is called. The value is ignored if the bound function is constructed using the new operator.
</code></pre><p>å½“ç»‘å®šå‡½æ•°åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œè¿™ä¸ªå€¼å°†ä½œä¸º this å‚æ•°ä¼ é€’ç»™ç›®æ ‡å‡½æ•°ã€‚å¦‚æœç»‘å®šå‡½æ•°ä½¿ç”¨äº† new æ“ä½œç¬¦ï¼Œè¿™ä¸ªå€¼ä¼šè¢«å¿½ç•¥ã€‚</p><p><strong>arg1, arg2, &mldr;</strong></p><pre><code>Arguments to prepend to arguments provided to the bound function when invoking the target function.
</code></pre><p>åœ¨ç›®æ ‡å‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œä¼ é€’ç»™ç»‘å®šå‡½æ•°çš„å‚æ•°ã€‚</p><h3 id=33-description-æè¿°>3.3 Description æè¿°</h3><pre><code>The bind() function creates a new function (a bound function) with the same function body (internal call property in ECMAScript 5 terms) as the function it is being called on (the bound functionâ€™s target function) with the this value bound to the first argument of bind(), which cannot be overridden. bind() also accepts leading default arguments to provide to the target function when the bound function is called. A bound function may also be constructed using the new operator: doing so acts as though the target function had instead been constructed. The provided this value is ignored, while prepended arguments are provided to the emulated function.
</code></pre><p>bind æ–¹æ³•åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼ˆç»‘å®šå‡½æ•°ï¼‰ï¼Œå‡½æ•°ä½“å’Œè°ƒç”¨çš„å‡½æ•°ä¸€æ ·ï¼Œå…¶ä¸­ this å€¼ä¸º bind æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¸èƒ½è¢«é‡å†™ã€‚
ç»‘å®šå‡½æ•°åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä¹Ÿä¼šæ¥å—ç›®æ ‡å‡½æ•°çš„é»˜è®¤å‚æ•°ã€‚ç»‘å®šå‡½æ•°ä¹Ÿå¯ä»¥é€šè¿‡ new æ“ä½œç¬¦æ„å»ºï¼šå°±å¥½åƒç›®æ ‡å‡½æ•°è¢«æ„å»ºå‡½æ•°æ›¿æ¢äº†ï¼ˆï¼Ÿï¼‰ã€‚æä¾›çš„ this å€¼ä¼šè¢«å¿½ç•¥ï¼ˆçœ‹ä¸æ‡‚ï¼‰ã€‚</p><h3 id=34-examples-ä¾‹å­>3.4 Examples ä¾‹å­</h3><h4 id=341-creating-a-bound-function>3.4.1 Creating a bound function</h4><p>åˆ›å»ºç»‘å®šå‡½æ•°ã€‚æœ€åŸºæœ¬çš„ç»‘å®šå‡½æ•°æ–¹å¼ã€‚</p><pre><code>this.x = 9; 
var module = {
  x: 81,
  getX: function() { return this.x; }
};

module.getX(); // 81

var retrieveX = module.getX;
retrieveX(); // 9, å› ä¸º this æŒ‡å‘å…¨å±€å¯¹è±¡

// åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå…¶ä¸­ this æŒ‡å‘ module
var boundGetX = retrieveX.bind(module);
boundGetX(); // 81
</code></pre><h4 id=342-partial-functions>3.4.2 Partial Functions</h4><p>éƒ¨åˆ†å‡½æ•°ã€‚å¯ä»¥å»ºç«‹æœ‰é»˜è®¤å‚æ•°çš„å‡½æ•°ã€‚</p><pre><code>function list() {
  return Array.prototype.slice.call(arguments);
}

var list1 = list(1, 2, 3); // [1, 2, 3]

// åˆ›å»ºä¸€ä¸ªæœ‰é¢„ç½®å‚æ•°çš„å‡½æ•°
var leadingThirtysevenList = list.bind(undefined, 37);

var list2 = leadingThirtysevenList(); // [37]
var list3 = leadingThirtysevenList(1, 2, 3); // [37, 1, 2, 3]
</code></pre><h4 id=343-with-settimeout>3.4.3 With setTimeout</h4><p>åœ¨è°ƒç”¨ setTimeout æ—¶è°ƒç”¨ã€‚å› ä¸ºåœ¨é»˜è®¤çš„ setTimeout æ–¹æ³•ä¸­ï¼Œthis å‚æ•°ä¼šè¢«è®¾ç½®ä¸ºå…¨å±€å¯¹è±¡ï¼Œé€šè¿‡ bind æ–¹æ³•ï¼Œå¯ä»¥æŒ‡å®š setTimeout ä¸­ this çš„å€¼ã€‚</p><pre><code>function LateBloomer() {
  this.petalCount = Math.ceil(Math.random() * 12) + 1;
}

// åœ¨ bloom ä¹‹åæ ¼1sï¼Œè°ƒç”¨ declare 
LateBloomer.prototype.bloom = function() {
  window.setTimeout(this.declare.bind(this), 1000);
};

LateBloomer.prototype.declare = function() {
  console.log('I am a beautiful flower with ' +
    this.petalCount + ' petals!');
};

var flower = new LateBloomer();
flower.bloom();  // after 1 second, triggers the 'declare' method
</code></pre><h4 id=344-bound-functions-used-as-constructors-æŠŠç»‘å®šå‡½æ•°å½“æˆæ„é€ å‡½æ•°ä¸€æ ·ä½¿ç”¨>3.4.4 Bound functions used as constructors æŠŠç»‘å®šå‡½æ•°å½“æˆæ„é€ å‡½æ•°ä¸€æ ·ä½¿ç”¨</h4><pre><code>TIPï¼šè¿™èŠ‚ä»‹ç»çš„åŠŸèƒ½å±äº bind æ–¹æ³•ä¸­çš„è¾¹ç¼˜ä½¿ç”¨ï¼Œè¿™äº›ä½¿ç”¨å¹¶ä¸æ˜¯æœ€ä½³è§£å†³æ–¹æ¡ˆï¼Œä¸åº”è¯¥å‡ºç°åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€‚è¿™é‡Œç®€å•è´´å†™ä»£ç ã€‚

function Point(x, y) {
  this.x = x;
  this.y = y;
}

Point.prototype.toString = function() { 
  return this.x + ',' + this.y; 
};

var p = new Point(1, 2);
p.toString(); // '1,2'

var emptyObj = {};
var YAxisPoint = Point.bind(emptyObj, 0/*x*/);
// not supported in the polyfill below,
// works fine with native bind:
var YAxisPoint = Point.bind(null, 0/*x*/);

var axisPoint = new YAxisPoint(5);
axisPoint.toString(); // '0,5'

axisPoint instanceof Point; // true
axisPoint instanceof YAxisPoint; // true
new Point(17, 42) instanceof YAxisPoint; // true
</code></pre><h4 id=345-creating-shortcuts-åˆ›å»ºå¿«æ·æ–¹å¼>3.4.5 Creating shortcuts åˆ›å»ºå¿«æ·æ–¹å¼</h4><p>å½“ä½ æƒ³åˆ›å»ºä¸€ä¸ªæœ‰ç‰¹æ®Š this å€¼çš„å‡½æ•°å¿«æ·æ–¹å¼æ—¶ï¼Œbind æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚é€šè¿‡ä¸‹é¢çš„å¯¹æ¯”å°±å¯ä»¥çŸ¥é“ï¼Œ bind åˆ›å»ºçš„æ–¹å¼æ›´åŠ é«˜æ•ˆã€‚</p><pre><code>// ä¸ä½¿ç”¨ bind çš„æƒ…å†µ
var slice = Array.prototype.slice;

// ...

slice.apply(arguments);

////////////////////////////////////////////

// ä½¿ç”¨ bind çš„æƒ…å†µ
var unboundSlice = Array.prototype.slice;
var slice = Function.prototype.apply.bind(unboundSlice);

// ...

slice(arguments);
</code></pre><h3 id=35-polyfill>3.5 Polyfill</h3><p>å› ä¸º bind æ˜¯ ECMA-262 çš„æ ‡å‡†ï¼Œæ‰€ä»¥ä¸€éƒ¨åˆ†æµè§ˆå™¨æ˜¯ä¸æ”¯æŒçš„ã€‚ä¸‹é¢åˆ™æ˜¯è®©æµè§ˆå™¨æ”¯æŒçš„å…¼å®¹ä»£ç ã€‚</p><pre><code>if (!Function.prototype.bind) {
  Function.prototype.bind = function(oThis) {
    if (typeof this !== 'function') {
      // closest thing possible to the ECMAScript 5
      // internal IsCallable function
      throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');
    }

    var aArgs   = Array.prototype.slice.call(arguments, 1),
        fToBind = this,
        fNOP    = function() {},
        fBound  = function() {
          return fToBind.apply(this instanceof fNOP
                 ? this
                 : oThis,
                 aArgs.concat(Array.prototype.slice.call(arguments)));
        };

    if (this.prototype) {
      // native functions don't have a prototype
      fNOP.prototype = this.prototype; 
    }
    fBound.prototype = new fNOP();

    return fBound;
  };
}
</code></pre><h3 id=æ€»ç»“>æ€»ç»“</h3><p>åˆ°è¿™é‡Œï¼Œcallã€apply å’Œ bind çš„ä»‹ç»å°±å®Œäº†ã€‚é‚£ä¹ˆï¼Œè¿™ä¸‰è€…æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»å‘¢ï¼Ÿ</p><p>call èƒ½åšçš„äº‹æƒ…ï¼Œapply ä¹Ÿå¯ä»¥åšã€‚ä½† apply èƒ½åšçš„äº‹æƒ…ï¼Œcall ä¸ä¸€å®šè¡Œã€‚ç„¶åï¼Œapply å¯ä»¥å¯¹å†…ç½®å‡½æ•°è¿›è¡Œå·§å¦™çš„è°ƒç”¨ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå¹¶æ²¡æœ‰å“ªä¸€ä¸ªæ˜¯å¤šä½™çš„ã€‚</p><p>é‚£ä¹ˆ call/apply å’Œ bind ä¹‹é—´çš„åŒºåˆ«å‘¢ï¼Ÿæ—¢ç„¶æœ‰äº† call/applyï¼Œä¸ºä»€ä¹ˆ ES5 è¿˜æ˜¯å¢åŠ äº† bind ï¼Ÿæˆ‘ä»¬ä»€ä¹ˆæ—¶å€™æ‰åº”è¯¥ç”¨ bind ï¼Ÿ</p><p><strong>åŒºåˆ«</strong>ï¼šcall/apply æ˜¯ç«‹åˆ»è°ƒç”¨å‡½æ•°çš„ï¼Œbind æ˜¯è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç„¶åå¯ä»¥åœ¨å…¶ä»–æ—¶å€™è°ƒç”¨ã€‚</p><pre><code>var person = {  
  name: &quot;James Smith&quot;,
  hello: function(thing) {
    console.log(this.name + &quot; says hello &quot; + thing);
  }
}
// call
person.hello.call(person, &quot;world&quot;); // output: James Smith says hello world

// bind
var helloFunc = person.hello.bind(person);
helloFunc(&quot;world&quot;);  // output: James Smith says hello world
</code></pre><p><strong>ä½¿ç”¨</strong>ï¼šbind ä¸€èˆ¬ç”¨åœ¨å¼‚æ­¥è°ƒç”¨å’Œäº‹ä»¶ï¼Œä¸‹é¢æ¥çœ‹ä¸ªä¾‹å­ã€‚</p><pre><code>function MyObject(element) {
    this.elm = element;

    element.addEventListener('click', this.log, false);
};

MyObject.prototype.log = function(e) {
     var t = this; 
     console.log(this);
};

var submit = document.getElementById(&quot;submit&quot;);

var _obj = new MyObject(submit);
</code></pre><p>ä¸Šé¢ä¾‹å­ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œlog æ–¹æ³•é‡Œé¢çš„ this æ˜¯ä»€ä¹ˆï¼Ÿæƒ³ä¸€ä¸‹ã€‚</p><pre><code>// log this: &lt;input type=&quot;button&quot; id=&quot;submit&quot; class=&quot;button&quot; value=&quot;ç‚¹å‡»&quot;&gt;
</code></pre><p>æ˜¯çš„ï¼Œlog é‡Œé¢çš„ this å°±æ˜¯ç»‘å®šäº‹ä»¶çš„å…ƒç´ ã€‚ä½†æˆ‘ä»¬å…¶å®æƒ³è¦çš„æ˜¯ MyObject å¯¹è±¡ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼ŸåŠ ä¸ª bind å°±å¯ä»¥äº†ã€‚</p><pre><code>function MyObject(element) {
    this.elm = element;

    element.addEventListener('click', this.log.bind(this), false);
};

MyObject.prototype.log = function(e) {
     var t = this; 
     console.log(this); // MyObject {elm: input#submit.button}
};

var submit = document.getElementById(&quot;submit&quot;);

var myO = new MyObject(submit);
</code></pre><p>å—¯ï¼Œçœ‹æ‡‚äº†å§ï½è¿™ä¸‰ä¸ªå‡½æ•°è®¤çœŸç¢ç£¨ä¸‹è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œå¿«æ¥ä½¿ç”¨å§ã€‚</p></div><footer class=post-footer><div class=post-tags><a href=/tags/js/>js</a>
<a href=/tags/apply/>apply</a>
<a href=/tags/call/>call</a>
<a href=/tags/bind/>bind</a></div><nav class=post-nav><a class=prev href=/post/2016/02-01-year-summary/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">æˆ‘çš„2015</span>
<span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span></a>
<a class=next href=/post/2016/01-26-promise-study-3/><span class="next-text nav-default">Promiseåˆçº§æ•™ç¨‹3ï¼šè§£ææµç¨‹</span>
<span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=copyright><span class=copyright-year>&copy;
2013 -
2022<span class=heart>ğŸ¥•</span><span>cirplan</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script>window.onload=function(){const e="fixed-open",n="slideout-open",s="icon-click",t=document.querySelector("#mobile-navbar-icon");t.addEventListener("click",o=>{const i=document.querySelector("#mobile-navbar"),a=document.querySelector("#mobile-panel");i.classList.contains(e)?(i.classList.remove(e),a.classList.remove(e),t.classList.remove(s),document.documentElement.classList.remove(n)):(i.classList.add(e),a.classList.add(e),t.classList.add(s),document.documentElement.classList.add(n))})}</script></body></html>