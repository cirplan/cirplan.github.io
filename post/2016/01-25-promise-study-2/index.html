<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Promiseåˆçº§æ•™ç¨‹2ï¼šè¯¦ç»†ä»‹ç» - Cirplan</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="cirplan"><meta name=description content="Promiseåˆçº§æ•™ç¨‹2ï¼šè¯¦ç»†ä»‹ç»"><meta name=keywords content="js,promise"><link rel=canonical href=https://cirplan.github.io/post/2016/01-25-promise-study-2/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link href=/sass/main.min.4325dd250c3d3e29d579a819f16fd876adbc5a03b3a1b32d2eefe0a067e8f219.css rel=stylesheet><meta property="og:title" content="Promiseåˆçº§æ•™ç¨‹2ï¼šè¯¦ç»†ä»‹ç»"><meta property="og:description" content="Promiseåˆçº§æ•™ç¨‹2ï¼šè¯¦ç»†ä»‹ç»"><meta property="og:type" content="article"><meta property="og:url" content="https://cirplan.github.io/post/2016/01-25-promise-study-2/"><meta property="article:section" content="post"><meta property="article:published_time" content="2016-01-25T01:12:27+08:00"><meta property="article:modified_time" content="2016-01-25T01:12:27+08:00"><meta itemprop=name content="Promiseåˆçº§æ•™ç¨‹2ï¼šè¯¦ç»†ä»‹ç»"><meta itemprop=description content="Promiseåˆçº§æ•™ç¨‹2ï¼šè¯¦ç»†ä»‹ç»"><meta itemprop=datePublished content="2016-01-25T01:12:27+08:00"><meta itemprop=dateModified content="2016-01-25T01:12:27+08:00"><meta itemprop=wordCount content="2690"><meta itemprop=keywords content="js,promise,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Promiseåˆçº§æ•™ç¨‹2ï¼šè¯¦ç»†ä»‹ç»"><meta name=twitter:description content="Promiseåˆçº§æ•™ç¨‹2ï¼šè¯¦ç»†ä»‹ç»"></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Cirplan</a></div><div class=mobile-navbar-icon id=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>ä¸»é¡µ</li></a><a href=/post/><li class=mobile-menu-item>å½’æ¡£</li></a><a href=/tags/><li class=mobile-menu-item>æ ‡ç­¾</li></a><a href=/categories/><li class=mobile-menu-item>åˆ†ç±»</li></a><a href=https://github.com/cirplan><li class=mobile-menu-item>Github</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Cirplan</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>ä¸»é¡µ</a></li><li class=menu-item><a class=menu-item-link href=/post/>å½’æ¡£</a></li><li class=menu-item><a class=menu-item-link href=/tags/>æ ‡ç­¾</a></li><li class=menu-item><a class=menu-item-link href=/categories/>åˆ†ç±»</a></li><li class=menu-item><a class=menu-item-link href=https://github.com/cirplan>Github</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Promiseåˆçº§æ•™ç¨‹2ï¼šè¯¦ç»†ä»‹ç»</h1><div class=post-meta><span class=post-time>2016-01-25</span><div class=post-category><a href=/categories/js/>js</a></div><span class=more-meta>çº¦ 2690 å­—</span>
<span class=more-meta>é¢„è®¡é˜…è¯» 6 åˆ†é’Ÿ</span></div></header><div class=post-outdated><div class=warn><p>ã€æ³¨æ„ã€‘æœ€åæ›´æ–°äº <span class=timeago datetime=2016-01-25T01:12:27 title=2016-01-25>2016-01-25, </span>ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚</p></div></div><div class=post-content><p>ä¸Šä¸€ç¯‡ç®€å•ä»‹ç»äº† Promise çš„å¤–å½¢ï¼Œè®©å¤§å®¶äº†è§£ Promise æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œå¯ä»¥ç”¨åœ¨å“ªé‡Œï¼Œæœ‰ä¸ªå¿ƒç†å‡†å¤‡ã€‚ä¸ç„¶çªç„¶è·³å‡ºä¸ªæé¾™å‡ºæ¥ï¼Œå“ä½ ä»¬ä¸€è·³ï¼Œ233ã€‚
å…¶å®è¿™ç¯‡æ–‡ç« æ‰ç®—æ­£å¼ä»‹ç» Promiseï¼Œå’³å’³&mldr;</p><pre><code>æœ¬æ¥æƒ³å‘¨æœ«å†™çš„ï¼Œä¸è¿‡é‡åˆ°äº†å¹¿ä¸œç™¾å¹´éš¾é‡çš„ä¸‹é›ªå¤©æ°”ï¼Œä¸€ç›´çªåœ¨åºŠä¸Šå‘æŠ–ï¼Œæ‰€ä»¥æ‹–åˆ°ç°åœ¨ï¼ˆå¥½å§ï¼Œå…¶å®æ˜¯æ‡’ï¼‰ã€‚
</code></pre><p>Promise å·²ç»æœ‰å¾ˆå¤šäººä»‹ç»äº†ï¼Œè¿™é‡Œå®‰åˆ©ä¸€äº›æ¯”è¾ƒå€¼å¾—çœ‹çš„æ–‡ç« ï¼Œä¸å¦¨å…ˆçœ‹çœ‹ã€‚</p><ul><li><a href=http://www.html5rocks.com/zh/tutorials/es6/promises/>JavaScript Promises</a>ï¼ˆå¦‚æœæ‰“ä¸å¼€ï¼Œè¯·ç¿»å¢™ï¼‰ï¼›</li><li>é˜®å¤§å¤§çš„ <a href=http://es6.ruanyifeng.com/#docs/promise>Promiseå¯¹è±¡</a>ï¼›</li><li>ç½‘å‹ç¿»è¯‘çš„ <a href=http://liubin.org/promises-book/>JavaScript Promiseè¿·ä½ ä¹¦</a>ã€‚</li></ul><p>ä¼°è®¡ä¸Šé¢çš„çœ‹å®Œï¼Œå¯¹ Promise çš„å¤§æ¦‚éƒ½æ‡‚äº†ï¼Œé‚£æ¥ä¸‹æ¥çš„å†…å®¹ï¼Œç†è®ºä¸Šå¯ä»¥ä¸ç”¨çœ‹äº†ï¼Œå› ä¸ºä¸Šé¢çš„å·²ç»è¯´çš„å¾ˆå…¨å¾ˆè¯¦ç»†äº†ï½ï½ä¸è¿‡ï¼Œæˆ‘è¿˜æ˜¯æŒ‰ä¸ªäººç†è§£ï¼Œæ•´ç†ä¸€ä¸‹ã€‚</p><h1 id=1-promise-å®šä¹‰>1. Promise å®šä¹‰</h1><h2 id=11-æ˜¯ä»€ä¹ˆ>1.1 æ˜¯ä»€ä¹ˆ</h2><p>Promise æ˜¯æŠ½è±¡å¼‚æ­¥å¤„ç†å¯¹è±¡ä»¥åŠå¯¹å…¶è¿›è¡Œå„ç§æ“ä½œçš„ç»„ä»¶ &ndash; æ¥è‡ª <a href=http://liubin.org/promises-book/>JavaScript Promiseè¿·ä½ ä¹¦</a>ã€‚</p><h2 id=12-è§„èŒƒ>1.2 è§„èŒƒ</h2><p>ES6 çš„[Promise][0]æ˜¯éµå¾ª <a href=https://promisesaplus.com/>Promises/A+</a> è§„èŒƒçš„ã€‚Promises/A+ ä¸€å¼€å§‹æ˜¯ç¤¾åŒºè§„èŒƒï¼Œç„¶åå¤§éƒ¨åˆ†çš„ Promise ç±»åº“éµå¾ªäº†è¿™ä¸ªè§„èŒƒï¼Œæ‰€ä»¥æ¸æ¸å˜æˆäº†ä¸€ä¸ªæ ‡å‡†ã€‚
æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ Promises/A+ çš„è§„èŒƒå»å­¦ä¹  Promiseã€‚</p><p><a href=http://segmentfault.com/a/1190000002452115>Promises/A+ä¸­æ–‡ç‰ˆç¿»è¯‘</a>åœ¨è¿™é‡Œï¼Œè‹±æ–‡çœ‹ä¸å¤ªæ‡‚å¯ä»¥çœ‹çœ‹ç¿»è¯‘ç‰ˆæœ¬ã€‚</p><h2 id=13-çŠ¶æ€>1.3 çŠ¶æ€</h2><p>æ¯ä¸ª Promise å¯¹è±¡æœ‰ä¸€ç§çŠ¶æ€ï¼šPendingï¼ˆç­‰å¾…ï¼‰ã€Resolved/Fulfilledï¼ˆæˆåŠŸï¼‰å’Œ Rejectedï¼ˆå¤±è´¥ï¼‰ä¸­çš„ä¸€ç§ï¼Œå˜åŒ–è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><img src=/post/2016/images/20160122promise/promise_states.png alt=promise_state></p><p>å¦‚ä¸Šå›¾ï¼ŒçŠ¶æ€åªèƒ½ä» Pending å˜ä¸º Resolved æˆ–è€… Rejected ä¸¤è€…ä¹‹ä¸­çš„ä¸€ç§ï¼Œ<strong>è¿‡ç¨‹ä¸å¯ä»¥é€†è½¬</strong>ã€‚</p><h1 id=2-promise-ç”¨æ³•>2. Promise ç”¨æ³•</h1><p>è¿™é‡Œä¸»è¦ä»‹ç» Promise çš„ä¸€äº›æ–¹æ³•ã€‚</p><h2 id=21-new-promise>2.1 new Promise</h2><p>é€šè¿‡ newï¼Œæ–°å»º Promise å¯¹è±¡ï¼Œè¿™æ˜¯æœ€å¸¸è§„çš„ç”¨æ³•ã€‚çœ‹ä¸Šä¸€ç¯‡æ–‡ç« çš„ä¾‹å­ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// ex1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>startTime</span> <span class=o>=</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;start&#39;</span><span class=p>,</span> <span class=nx>startTime</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>handler</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;done&#39;</span><span class=p>,</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>startTime</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>500</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>handler</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>val</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;then resolve&#39;</span><span class=p>,</span> <span class=nx>val</span><span class=p>,</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>startTime</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;then reject&#39;</span><span class=p>,</span> <span class=nx>e</span><span class=p>,</span> <span class=nb>Date</span><span class=p>.</span><span class=nx>now</span><span class=p>()</span> <span class=o>-</span> <span class=nx>startTime</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>ç»“æœå¾ˆæ˜æ˜¾ï¼Œæ˜¯è¿›å…¥æˆåŠŸæ‰¿è¯ºçš„å›è°ƒï¼Œè¿™é‡Œæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚</p><h2 id=22-promiseresolve>2.2 Promise.resolve</h2><p>é™æ€æ–¹æ³• <code>Promise.resolve(value)</code> æ˜¯ <code>new Promise()</code> çš„å¿«æ·æ–¹å¼ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=mi>42</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç­‰ä»·äº
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>resolve</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nx>resolve</span><span class=p>(</span><span class=mi>42</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>é—®é¢˜ï¼šå‚æ•° value å¯ä»¥æ˜¯ä»€ä¹ˆï¼Ÿ</p><ol><li>ç©ºã€‚</li><li>æ™®é€šçš„å¯¹è±¡ã€‚</li><li>å¸¦æœ‰ then æ–¹æ³•çš„ä¸æ ‡å‡† Promise å¯¹è±¡ã€‚</li><li>Promise å¯¹è±¡ã€‚</li></ol><p>ä¸‹é¢è®©æˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥éªŒè¯ï¼Œä¸‹é¢ç»“æœæ˜¯åœ¨ chrome & firefox é‡Œçš„è°ƒè¯•ç»“æœã€‚</p><h3 id=221-ç©º>2.2.1 ç©º</h3><p><strong>å¦‚æœä¸ä¼ å‚æ•°</strong>ï¼Œåˆ™è¿”å›ä¸€ä¸ª value ä¸º undefined çš„ Promise å¯¹è±¡ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// value ä¸ºç©ºï¼Œè¿”å›çš„Promiseå¯¹è±¡valueä¸ºundefined
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=c1>// chrome  --&gt; Promise {[[PromiseStatus]]: &#34;resolved&#34;, [[PromiseValue]]: undefined}
</span></span></span><span class=line><span class=cl><span class=c1>// firefox --&gt; Promise { &lt;state&gt;: &#34;fulfilled&#34;, &lt;value&gt;: undefined }
</span></span></span></code></pre></td></tr></table></div></div><h3 id=222-æ™®é€šçš„å¯¹è±¡>2.2.2 æ™®é€šçš„å¯¹è±¡</h3><p><strong>å¦‚æœå‚æ•°ä¸ºæ™®é€šå¯¹è±¡</strong>ï¼Œè¿”å›çŠ¶æ€ä¸º Resolve çš„ Promise å¯¹è±¡ï¼Œå…¶ value ä¸ºä¼ äººçš„å‚æ•°ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// value ä¸ºstring
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;42&#39;</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=c1>// chrome  --&gt; Promise {[[PromiseStatus]]: &#34;resolved&#34;, [[PromiseValue]]: &#34;42&#34;}
</span></span></span><span class=line><span class=cl><span class=c1>// firefox --&gt; Promise { &lt;state&gt;: &#34;fulfilled&#34;, &lt;value&gt;: &#34;42&#34; }
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// value ä¸º object
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>({</span><span class=nx>a</span><span class=o>:</span><span class=mi>1</span><span class=p>})</span> 
</span></span><span class=line><span class=cl><span class=c1>// chrome  --&gt; Promise {[[PromiseStatus]]: &#34;resolved&#34;, [[PromiseValue]]: Object}
</span></span></span><span class=line><span class=cl><span class=c1>// firefox --&gt; Promise { &lt;state&gt;: &#34;fulfilled&#34;, &lt;value&gt;: Object }
</span></span></span></code></pre></td></tr></table></div></div><h3 id=223-å¸¦æœ‰-then-æ–¹æ³•çš„ä¸æ ‡å‡†-promise-å¯¹è±¡>2.2.3 å¸¦æœ‰ then æ–¹æ³•çš„ä¸æ ‡å‡† Promise å¯¹è±¡</h3><p><strong>å¦‚æœå‚æ•°ä¸ºå¸¦æœ‰thenæ–¹æ³•çš„ä¸æ ‡å‡† Promise å¯¹è±¡</strong>ï¼Œè¿”å›æ–°çš„ Promise å¯¹è±¡ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ jQuery çš„ <code>$.ajax</code> æ–¹æ³•è¿”å›çš„ deferred å¯¹è±¡ã€‚
é¡µé¢å¼•å…¥ jQuery-2.1.4ï¼Œå¦‚ä¸‹ï¼š</p><p><img src=/post/2016/images/20160122promise/ajax.png alt=jQuery_ajax></p><p>é€šè¿‡ä¸Šå›¾ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ deferred å¯¹è±¡æ˜¯ thenableï¼ˆåŒ…å«äº†thenæ–¹æ³•çš„å¯¹è±¡æˆ–å‡½æ•°ï¼‰å¯¹è±¡ï¼Œä½†ä¸æ˜¯æ ‡å‡†çš„ Promise å¯¹è±¡ï¼ˆæ€æ ·æ‰ç®—æ ‡å‡†çš„Promiseå¯¹è±¡ï¼Ÿï¼‰ã€‚</p><p>é‚£çœ‹çœ‹é€šè¿‡ Promise.resolve è½¬æ¢æ•ˆæœï¼Œå…ˆçœ‹è¯·æ±‚æˆåŠŸçš„è¿”å›ç»“æœï¼Œå¯ä»¥çœ‹åˆ° <code>[[PromiseValue]]</code> å°±æ˜¯ $.ajax çš„ deffered å¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š</p><p><img src=/post/2016/images/20160122promise/promise_resolve_1.png alt=resolve_1></p><p>å†çœ‹çœ‹è¯·æ±‚é”™è¯¯çš„æ—¶å€™ç»“æœï¼Œå¦‚ä¸‹ï¼š</p><p><img src=/post/2016/images/20160122promise/promise_resolve_2.png alt=resolve_2></p><p>æœ‰æ²¡æœ‰çœ‹å‡ºä»€ä¹ˆï¼Ÿæ˜¯ä¸æ˜¯æˆåŠŸæˆ–å¤±è´¥ï¼Œè¿”å› Promise å¯¹è±¡çš„çŠ¶æ€éƒ½æ˜¯ resolved ï¼Ÿé‚£æ˜¯ä¸æ˜¯éƒ½è¿›å…¥ resolved çš„å›è°ƒï¼Ÿæƒ³ä¸€ä¸‹å¥½åƒæ˜¯çš„å“¦ï¼Œè®©æˆ‘ä»¬æ¥éªŒè¯ä¸‹ï½</p><p>å…ˆçœ‹è¯·æ±‚æˆåŠŸçš„æ—¶å€™ï¼Œå…¶å®æ²¡ä»€ä¹ˆæ‚¬å¿µï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>handler</span> <span class=o>=</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span><span class=nx>$</span><span class=p>.</span><span class=nx>ajax</span><span class=p>(</span><span class=s1>&#39;/stock/chart/1414672685/position&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>handler</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>val</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;resolve&#39;</span><span class=p>,</span> <span class=nx>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;rejected&#39;</span><span class=p>,</span> <span class=nx>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/post/2016/images/20160122promise/promise_resolve_3.png alt=resolve_3></p><p>å†çœ‹çœ‹è¯·æ±‚é”™è¯¯çš„æ—¶å€™ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>handler</span> <span class=o>=</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span><span class=nx>$</span><span class=p>.</span><span class=nx>ajax</span><span class=p>(</span><span class=s1>&#39;/stock/chart/1414672685/position123&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=nx>handler</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>val</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;resolve&#39;</span><span class=p>,</span> <span class=nx>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;rejected&#39;</span><span class=p>,</span> <span class=nx>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/post/2016/images/20160122promise/promise_resolve_4.png alt=resolve_4></p><p>çº³å°¼ï¼Œ<strong>ä¸ºä»€ä¹ˆè¿›å…¥ rejected çš„å›è°ƒäº†</strong>ï¼Ÿä¸æ˜¯è¯´å¥½ Promise çš„çŠ¶æ€ï¼Œä¸€æ—¦ä» Pending åˆ° Resolved æˆ– Rejected å°±ä¸èƒ½æ”¹å˜äº†å—ï¼Ÿä½ ä»¬è¯´è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p><p>æœ‰äººè¯´ï¼Œçœ‹ä¸Šé¢ä¸¤å¼ å›¾ä¸­ Promise æ‰“å°å‡ºæ¥çš„çŠ¶æ€æ˜¯ <code>Pending</code>ï¼Œç§˜å¯†æ‰€åœ¨ã€‚å’³å’³ï¼Œå…¶å® <code>Promise.then</code> æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡ï¼Œæ–¹ä¾¿é“¾å¼è°ƒç”¨è€Œå·²ã€‚</p><p>å…¶å®è¿™ä¸ªé—®é¢˜ä¸ <code>Promise</code> çš„è§£ææµç¨‹æœ‰å…³ï¼Œæˆ‘ä»¬å¾…ä¼šå†çœ‹è¿™ä¸ªé—®é¢˜ï½</p><h3 id=224-promise-å¯¹è±¡>2.2.4 Promise å¯¹è±¡</h3><p><strong>å¦‚æœå‚æ•°ä¸º Promise å¯¹è±¡</strong>ï¼Œç›´æ¥è¿”å›è¯¥ Promise å¯¹è±¡ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>promise1</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>rejected</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;done&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=nx>promise1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>promise1</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>rejected</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>rejected</span><span class=p>(</span><span class=s1>&#39;fail&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=nx>promise1</span><span class=p>);</span>  
</span></span></code></pre></td></tr></table></div></div><p><img src=/post/2016/images/20160122promise/promise_resolve_5.png alt=resolve_5></p><h2 id=23-promisereject>2.3 Promise.reject</h2><p><code>Promise.reject(error)</code> æ˜¯å’Œ <code>Promise.resolve(value)</code> ç±»ä¼¼çš„é™æ€æ–¹æ³•ï¼Œæ˜¯ <code>new Promise()</code> æ–¹æ³•çš„å¿«æ·æ–¹å¼ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nb>Promise</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;å‡ºé”™äº†&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ç­‰ä»·äº
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>resolve</span><span class=p>,</span><span class=nx>reject</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nx>reject</span><span class=p>(</span><span class=k>new</span> <span class=nb>Error</span><span class=p>(</span><span class=s2>&#34;å‡ºé”™äº†&#34;</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p>æ­£å¸¸æ¥è¯´ï¼ŒPromise.reject çš„å‚æ•°éƒ½åº”è¯¥æ˜¯errorå¯¹è±¡ï¼Œè¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚</p><h2 id=24-promisethen>2.4 Promise.then</h2><p><code>Promise.then</code> æ˜¯ Promise é‡Œæ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨ <a href=https://promisesaplus.com/>Promises/A+</a> è§„èŒƒä¸­ï¼Œå¾ˆå¤§éƒ¨åˆ†çš„ç¯‡å¹…å°±ä»‹ç»è¿™ä¸ªæ–¹æ³•ã€‚</p><p>then æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Resolved çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯é€‰ï¼‰æ˜¯ Rejected çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œè°ƒç”¨åè¿”å›æ–°çš„ Promise å¯¹è±¡ã€‚å°±è¿™ä¹ˆçœ‹ï¼Œæ˜¯ä¸æ˜¯å®Œäº†ï¼Ÿ</p><p>æˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸‹é¢çš„ä¸¤ç‚¹ï¼š</p><ol><li>è§„èŒƒã€‚</li><li>è¿”å›æ–° Promise å¯¹è±¡çš„çŠ¶æ€æ˜¯æ€ä¹ˆå†³å®šçš„ã€‚</li></ol><h3 id=241-è§„èŒƒ>2.4.1 è§„èŒƒ</h3><pre><code>Promise.then(onFulfilled, onRejected)
</code></pre><p><code>onFulfilled</code> & <code>onRejected</code> çš„ç‰¹ç‚¹ï¼š</p><ul><li>å¯é€‰ã€‚</li><li>å¿…é¡»æ˜¯å‡½æ•°ï¼Œä¸ç„¶å¿½ç•¥ã€‚</li><li><code>onFulfilled</code> å¿…é¡»åœ¨ Promise çš„ Resolve çŠ¶æ€åè°ƒç”¨ï¼ŒPromise çš„ value ä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li><li><code>onRejected</code> å¿…é¡»åœ¨ Promise çš„ Rejected çŠ¶æ€åè°ƒç”¨ï¼ŒPromise çš„ reason ä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚</li><li>å½“æˆå‡½æ•°èˆ¬è°ƒç”¨ï¼ˆthisä¸ºundefinedï¼‰ã€‚</li></ul><p>å¯¹äºä¸€ä¸ªPromise , <code>then</code> å¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡ï¼š</p><ul><li>å½“ Promise <code>fulfilled</code> åï¼Œæ‰€æœ‰ onFulfilled éƒ½å¿…é¡»æŒ‰ç…§å…¶æ³¨å†Œé¡ºåºæ‰§è¡Œã€‚</li><li>å½“ Promise <code>rejected</code> åï¼Œæ‰€æœ‰ OnRejected éƒ½å¿…é¡»æŒ‰ç…§å…¶æ³¨å†Œé¡ºåºæ‰§è¡Œã€‚</li></ul><h3 id=242-è¿”å›æ–°-promise>2.4.2 è¿”å›æ–° Promise</h3><pre><code>promise2 = promise1.then(onFulfilled, onRejected);
</code></pre><ul><li>å¦‚æœ onFulfilled æˆ– onRejected è¿”å›äº†å€¼ x, åˆ™æ‰§è¡Œ Promise è§£ææµç¨‹ <code>[[Resolve]](promise2, x)</code>ã€‚</li><li>å¦‚æœ onFulfilled æˆ– onRejected æŠ›å‡ºäº†å¼‚å¸¸ e, åˆ™ promise2 åº”å½“ä»¥ e ä¸º reason è¢«æ‹’ç»ã€‚</li><li>å¦‚æœ onFulfilled ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ä¸” promise1 å·²ç» fulfilledï¼Œåˆ™ promise2 å¿…é¡»ä»¥ promise1 çš„å€¼ fulfilledã€‚</li><li>å¦‚æœ OnReject ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ä¸” promise1 å·²ç» rejected, åˆ™ promise2 å¿…é¡»ä»¥ç›¸åŒçš„ reason è¢«æ‹’ç»ã€‚</li></ul><p>å¥½å§ï¼Œä¸Šé¢è¿™äº›éƒ½æ˜¯ç…§æ¬è§„èŒƒçš„ä¸œè¥¿è€Œå·²ï¼ˆæˆ‘åªæ˜¯ä¸ªæ¬è¿å·¥ï¼Œå“­ï¼‰ï¼ŒåŸºæœ¬ä¸Šçœ‹ä¸€éå°±çŸ¥é“æ€ä¹ˆå›äº‹äº†ã€‚</p><h2 id=25-promisecatch>2.5 Promise.catch</h2><p><code>Promise.catch</code> åªæ˜¯ <code>Promise.then(undefined, onRejected)</code> æ–¹æ³•çš„ä¸€ä¸ªåˆ«åã€‚</p><p>è¿™é‡Œç›—ä¸ªä¾‹å­ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>taskA</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Task A&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>taskB</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Task B&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>onRejected</span><span class=p>(</span><span class=nx>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Catch Error: A or B&#34;</span><span class=p>,</span> <span class=nx>error</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>finalTask</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;Final Task&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>promise</span> <span class=o>=</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>promise</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>taskA</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>taskB</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=nx>onRejected</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>finalTask</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p><img src=/post/2016/images/20160122promise/promise-then-catch-flow.png alt=promise-then-catch-flow></p><p>ç‰¹ç‚¹ï¼š</p><ul><li>é”™è¯¯å…·æœ‰å†’æ³¡æ€§ï¼Œä¸€ç›´åˆ°æ•è·ä¸ºæ­¢ã€‚</li><li>IE8 ä¸‹ <code>promise.catch</code> æœ‰ä¿ç•™å­—é—®é¢˜ï¼Œç”¨ <code>promise["catch"]</code> åˆ™æ²¡é—®é¢˜ã€‚</li><li>å¦‚æœæ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œ<code>catch</code>ä¼šè‡ªåŠ¨è¢«å¿½ç•¥ã€‚</li></ul><h2 id=26-promiseall>2.6 Promise.all</h2><p>Promise.all æ¥æ”¶ä¸€ä¸ª promise å¯¹è±¡çš„æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ promise å¯¹è±¡ï¼Œç‰¹ç‚¹å¦‚ä¸‹ï¼š</p><ul><li>å½“æ•°ç»„å†…æ‰€æœ‰ promise å¯¹è±¡çš„çŠ¶æ€ä¸º Resolveï¼Œå…¶çŠ¶æ€æ‰ä¸º Resolveã€‚</li><li>å½“æ•°ç»„å†…æœ‰ä¸€ä¸ª promise å¯¹è±¡çš„çŠ¶æ€ä¸º Rejectedï¼Œå…¶çŠ¶æ€å°±ä¸º Rejectedï¼ˆè¿™ç‚¹promiseè¿·ä½ ä¹¦ä¸­çš„è¯´æ³•æ˜¯æœ‰è¯¯çš„ï¼‰ã€‚</li></ul><p>çœ‹æµ‹è¯•ä»£ç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// ç¬¬ä¸€ç§æƒ…å†µ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>promise1</span> <span class=o>=</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>promise2</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>promise3</span> <span class=o>=</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>([</span><span class=nx>promise1</span><span class=p>,</span> <span class=nx>promise2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>promise3</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>val</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;resolve&#39;</span><span class=p>,</span> <span class=nx>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;reject&#39;</span><span class=p>,</span> <span class=nx>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// resolve [1, &#34;error&#34;]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// ç¬¬äºŒç§æƒ…å†µ
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>promise1</span> <span class=o>=</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>promise2</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>promise3</span> <span class=o>=</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>([</span><span class=nx>promise1</span><span class=p>,</span> <span class=nx>promise2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>promise3</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>val</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;resolve&#39;</span><span class=p>,</span> <span class=nx>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;reject&#39;</span><span class=p>,</span> <span class=nx>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// reject 1
</span></span></span></code></pre></td></tr></table></div></div><h2 id=27-promiserace>2.7 Promise.race</h2><p>Promise.all çš„ç›¸å¯¹æ–¹æ³•ï¼Œåªè¦æ•°ç»„å†…æœ‰ä¸€ä¸ª promise å¯¹è±¡çš„çŠ¶æ€æ”¹å˜ï¼Œå…¶çŠ¶æ€å°±æ”¹å˜ã€‚</p><p>çœ‹æµ‹è¯•ä»£ç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>promise1</span> <span class=o>=</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>promise2</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(</span><span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;error&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>promise3</span> <span class=o>=</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>race</span><span class=p>([</span><span class=nx>promise1</span><span class=p>,</span> <span class=nx>promise2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>promise3</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>val</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;resolve&#39;</span><span class=p>,</span> <span class=nx>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;reject&#39;</span><span class=p>,</span> <span class=nx>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// resolve 1
</span></span></span></code></pre></td></tr></table></div></div><p>åˆ°è¿™é‡Œï¼ŒPromise çš„æ–¹æ³•å·²ç»ä»‹ç»å®Œäº†ã€‚ç„¶è€Œä¸Šé¢è¿˜æœ‰ä¸ªé—®é¢˜æ²¡è§£å†³ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸‹ Promise çš„è§£ææµç¨‹ã€‚</p><p>æœ¬æ¥æƒ³æ¥ç€å†™çš„ï¼Œä¸è¿‡çœŸçš„å¤ªé•¿äº†ï¼Œæ€•å¤§å®¶çœ‹çš„å¤´æ™•ã€‚</p><p>æ‰€ä»¥ï¼Œæœ‰å…´è¶£çš„è¯ï¼Œè¯·çœ‹ä¸‹ä¸€ç¯‡ <a href=/post/2016/01-26-promise-study-3/>Promise çš„è§£ææµç¨‹</a>ã€‚</p></div><footer class=post-footer><div class=post-tags><a href=/tags/js/>js</a>
<a href=/tags/promise/>promise</a></div><nav class=post-nav><a class=prev href=/post/2016/01-26-promise-study-3/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">Promiseåˆçº§æ•™ç¨‹3ï¼šè§£ææµç¨‹</span>
<span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span></a>
<a class=next href=/post/2016/01-22-promise-study-1/><span class="next-text nav-default">Promiseåˆçº§æ•™ç¨‹1ï¼šç®€å•ä½¿ç”¨</span>
<span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=cirplan/cirplan.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=copyright><span class=copyright-year>&copy;
2015 -
2022<span class=heart>ğŸ¥•</span><span>cirplan</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script>window.onload=function(){const e="fixed-open",n="slideout-open",s="icon-click",t=document.querySelector("#mobile-navbar-icon");t.addEventListener("click",o=>{const i=document.querySelector("#mobile-navbar"),a=document.querySelector("#mobile-panel");i.classList.contains(e)?(i.classList.remove(e),a.classList.remove(e),t.classList.remove(s),document.documentElement.classList.remove(n)):(i.classList.add(e),a.classList.add(e),t.classList.add(s),document.documentElement.classList.add(n))})}</script></body></html>