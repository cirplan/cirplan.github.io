<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>javaçš„urlrewritefilterç®€å•ä½¿ç”¨ - Cirplan</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="cirplan"><meta name=description content="javaçš„urlrewritefilterç®€å•ä½¿ç”¨"><meta name=keywords content="java,urlrewritefilter"><link rel=canonical href=https://cirplan.me/post/2014/12-12-java-urlrewritefilter/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link href=/sass/main.min.4325dd250c3d3e29d579a819f16fd876adbc5a03b3a1b32d2eefe0a067e8f219.css rel=stylesheet><meta property="og:title" content="javaçš„urlrewritefilterç®€å•ä½¿ç”¨"><meta property="og:description" content="javaçš„urlrewritefilterç®€å•ä½¿ç”¨"><meta property="og:type" content="article"><meta property="og:url" content="https://cirplan.me/post/2014/12-12-java-urlrewritefilter/"><meta property="article:section" content="post"><meta property="article:published_time" content="2014-12-12T21:42:40+08:00"><meta property="article:modified_time" content="2014-12-12T21:42:40+08:00"><meta itemprop=name content="javaçš„urlrewritefilterç®€å•ä½¿ç”¨"><meta itemprop=description content="javaçš„urlrewritefilterç®€å•ä½¿ç”¨"><meta itemprop=datePublished content="2014-12-12T21:42:40+08:00"><meta itemprop=dateModified content="2014-12-12T21:42:40+08:00"><meta itemprop=wordCount content="959"><meta itemprop=keywords content="java,urlrewritefilter,"><meta name=twitter:card content="summary"><meta name=twitter:title content="javaçš„urlrewritefilterç®€å•ä½¿ç”¨"><meta name=twitter:description content="javaçš„urlrewritefilterç®€å•ä½¿ç”¨"></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Cirplan</a></div><div class=mobile-navbar-icon id=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>ä¸»é¡µ</li></a><a href=/post/><li class=mobile-menu-item>å½’æ¡£</li></a><a href=/tags/><li class=mobile-menu-item>æ ‡ç­¾</li></a><a href=/categories/><li class=mobile-menu-item>åˆ†ç±»</li></a><a href=/about/><li class=mobile-menu-item>å…³äº</li></a><a href=https://github.com/cirplan><li class=mobile-menu-item>Github</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Cirplan</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>ä¸»é¡µ</a></li><li class=menu-item><a class=menu-item-link href=/post/>å½’æ¡£</a></li><li class=menu-item><a class=menu-item-link href=/tags/>æ ‡ç­¾</a></li><li class=menu-item><a class=menu-item-link href=/categories/>åˆ†ç±»</a></li><li class=menu-item><a class=menu-item-link href=/about/>å…³äº</a></li><li class=menu-item><a class=menu-item-link href=https://github.com/cirplan>Github</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>javaçš„urlrewritefilterç®€å•ä½¿ç”¨</h1><div class=post-meta><span class=post-time>2014-12-12</span><div class=post-category><a href=/categories/java/>java</a></div><span class=more-meta>çº¦ 959 å­—</span>
<span class=more-meta>é¢„è®¡é˜…è¯» 2 åˆ†é’Ÿ</span></div></header><div class=post-outdated><div class=warn><p>ã€æ³¨æ„ã€‘æœ€åæ›´æ–°äº <span class=timeago datetime=2014-12-12T21:42:40 title=2014-12-12>2014-12-12, </span>ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚</p></div></div><div class=post-content><p>ç”±äºé¡¹ç›®ä¸­åªç”¨äº†<code>tomcat</code>ï¼Œæ²¡æœ‰ç”¨<code>Apache</code>ï¼Œç„¶åæƒ³åš<code>www</code>é‡å®šå‘ã€‚å°±å¦‚è®©æ‰€æœ‰è®¿é—®<code>baidu.com</code>éƒ½301æ°¸ä¹…é‡å®šå‘åˆ°<code>www.baidu.com</code>ã€‚ç„¶åæ—¶é—´ç´§æ€¥ï¼Œå¯¹<code>Apache</code>ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼ˆæ‡’çš„å»é…ç½®ï¼‰ï¼Œå°±ç›´æ¥ç”¨äº†<code>java</code>çš„ä¸€ä¸ªåŒ…ï¼š
<code>urlrewritefilter</code>ã€‚</p><p>å®˜ç½‘æ˜¯ï¼š<a href=http://tuckey.org/urlrewrite/>http://tuckey.org/urlrewrite/</a>ã€‚ä½¿ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œç®€å•è¯´ä¸‹ã€‚</p><h3 id=1ä¸‹è½½>1.ä¸‹è½½</h3><p>å…ˆå»ä¸‹è½½<code>urlrewritefilter-x.x.x.jar </code>åŒ…ã€‚ä¸‹è½½å¥½æ”¾åˆ°<code>WEB-INF/lib</code>ç›®å½•ä¸‹ã€‚</p><h3 id=2é…ç½®webxml>2.é…ç½®web.xml</h3><p>ä¿®æ”¹web.xmlï¼ŒæŠŠä¸‹é¢ä»£ç æ”¾åˆ°æ‰€æœ‰servlet mappingsçš„å‰é¢ã€‚</p><pre><code>&lt;filter&gt;
    &lt;filter-name&gt;UrlRewriteFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.tuckey.web.filters.urlrewrite.UrlRewriteFilter&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
    &lt;filter-name&gt;UrlRewriteFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
    &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
&lt;/filter-mapping&gt;
</code></pre><p>è¿™é‡Œæ˜¯å¯¹åº”çš„å‚æ•°æ–‡æ¡£ <a href=http://urlrewritefilter.googlecode.com/svn/trunk/src/doc/manual/4.0/index.html#filterparams>filterparams</a>ã€‚è¿™å°±é…ç½®å®Œäº†ï¼ˆè¿™é‡Œæœ‰ä¸ªå¾ˆå‘çˆ¹çš„é—®é¢˜ï¼Œå¾…ä¼šè¯´ï¼‰ã€‚</p><h3 id=3å¢åŠ -urlrewritexml>3.å¢åŠ  <code>urlrewrite.xml</code></h3><p>ç„¶ååœ¨ <code>WEB-INF</code> æ–‡ä»¶å¤¹é‡Œå¢åŠ å¤š <code>urlrewrite.xml</code> æ–‡ä»¶ã€‚</p><p>ä¸‹é¢æ˜¯å®˜æ–¹æ ‡å‡†urlrewrite.xmlæ–‡æ¡£ï¼š</p><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;!DOCTYPE urlrewrite PUBLIC &quot;-//tuckey.org//DTD UrlRewrite 4.0//EN&quot;
        &quot;http://www.tuckey.org/res/dtds/urlrewrite4.0.dtd&quot;&gt;

&lt;!--

    Configuration file for UrlRewriteFilter
    http://www.tuckey.org/urlrewrite/

--&gt;
&lt;urlrewrite&gt;

    &lt;rule&gt;
        &lt;note&gt;
            The rule means that requests to /test/status/ will be redirected to /rewrite-status
            the url will be rewritten.
        &lt;/note&gt;
        &lt;from&gt;/test/status/&lt;/from&gt;
        &lt;to type=&quot;redirect&quot;&gt;%{context-path}/rewrite-status&lt;/to&gt;
    &lt;/rule&gt;


    &lt;outbound-rule&gt;
        &lt;note&gt;
            The outbound-rule specifies that when response.encodeURL is called (if you are using JSTL c:url)
            the url /rewrite-status will be rewritten to /test/status/.

            The above rule and this outbound-rule means that end users should never see the
            url /rewrite-status only /test/status/ both in thier location bar and in hyperlinks
            in your pages.
        &lt;/note&gt;
        &lt;from&gt;/rewrite-status&lt;/from&gt;
        &lt;to&gt;/test/status/&lt;/to&gt;
    &lt;/outbound-rule&gt;


    &lt;!--

    INSTALLATION

        in your web.xml add...

        &lt;filter&gt;
            &lt;filter-name&gt;UrlRewriteFilter&lt;/filter-name&gt;
            &lt;filter-class&gt;org.tuckey.web.filters.urlrewrite.UrlRewriteFilter&lt;/filter-class&gt;
            &lt;init-param&gt;
                &lt;param-name&gt;logLevel&lt;/param-name&gt;
                &lt;param-value&gt;WARN&lt;/param-value&gt;
            &lt;/init-param&gt;
        &lt;/filter&gt;
        &lt;filter-mapping&gt;
            &lt;filter-name&gt;UrlRewriteFilter&lt;/filter-name&gt;
            &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
        &lt;/filter-mapping&gt;

     EXAMPLES

     Redirect one url
        &lt;rule&gt;
            &lt;from&gt;/some/old/page.html&lt;/from&gt;
            &lt;to type=&quot;redirect&quot;&gt;/very/new/page.html&lt;/to&gt;
        &lt;/rule&gt;

    Redirect a directory
        &lt;rule&gt;
            &lt;from&gt;/some/olddir/(.*)&lt;/from&gt;
            &lt;to type=&quot;redirect&quot;&gt;/very/newdir/$1&lt;/to&gt;
        &lt;/rule&gt;

    Clean a url
        &lt;rule&gt;
            &lt;from&gt;/products/([0-9]+)&lt;/from&gt;
            &lt;to&gt;/products/index.jsp?product_id=$1&lt;/to&gt;
        &lt;/rule&gt;
    eg, /products/1234 will be passed on to /products/index.jsp?product_id=1234 without the user noticing.

    Browser detection
        &lt;rule&gt;
            &lt;condition name=&quot;user-agent&quot;&gt;Mozilla/[1-4]&lt;/condition&gt;
            &lt;from&gt;/some/page.html&lt;/from&gt;
            &lt;to&gt;/some/page-for-old-browsers.html&lt;/to&gt;
        &lt;/rule&gt;
    eg, will pass the request for /some/page.html on to /some/page-for-old-browsers.html only for older
    browsers whose user agent srtings match Mozilla/1, Mozilla/2, Mozilla/3 or Mozilla/4.

    Centralised browser detection
        &lt;rule&gt;
            &lt;condition name=&quot;user-agent&quot;&gt;Mozilla/[1-4]&lt;/condition&gt;
            &lt;set type=&quot;request&quot; name=&quot;browser&quot;&gt;moz&lt;/set&gt;
        &lt;/rule&gt;
    eg, all requests will be checked against the condition and if matched
    request.setAttribute(&quot;browser&quot;, &quot;moz&quot;) will be called.

    --&gt;

&lt;/urlrewrite&gt;
</code></pre><p>æˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„å°±ä¸¤ä¸ªï¼š</p><pre><code> //é‡å®šå‘ åœ°å€æ æ˜¾ç¤ºçš„æ˜¯å®é™…åœ°å€
    &lt;rule&gt;
        &lt;from&gt;/some/olddir/(.*)&lt;/from&gt;
        &lt;to type=&quot;redirect&quot;&gt;/very/newdir/$1&lt;/to&gt;
    &lt;/rule&gt;

//è½¬å‘ åœ°å€äº†æ˜¾ç¤ºçš„æ˜¯è™šæ‹Ÿåœ°å€
    &lt;rule&gt;
        &lt;from&gt;/products/([0-9]+)&lt;/from&gt;
        &lt;to&gt;/products/index.jsp?product_id=$1&lt;/to&gt;
    &lt;/rule&gt;
eg, /products/1234 will be passed on to /products/index.jsp?product_id=1234 without the user noticing.
</code></pre><p>åŒ¹é…çš„æ˜¯javaçš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><h3 id=4www301é‡å®šå‘>4.www301é‡å®šå‘</h3><p>ä¸‹é¢å°±æ˜¯æˆ‘è¦ç”¨åˆ°çš„ï¼š</p><pre><code>//å¦‚æœåœ°å€çš„åŸŸåä¸æ˜¯ www.baidu.com å°±ä¼šè·³è½¬åˆ°www.baidu.com
//ä¸ºäº†è€ƒè™‘å¼€å‘æƒ…å†µï¼ŒæŠŠ localhost ä¹ŸåŠ åˆ°é‡Œé¢
&lt;rule&gt;
    &lt;name&gt;seo redirect&lt;/name&gt;
    &lt;condition name=&quot;host&quot; operator=&quot;notequal&quot;&gt;^www.baidu.com&lt;/condition&gt;
    &lt;condition name=&quot;host&quot; operator=&quot;notequal&quot;&gt;^localhost&lt;/condition&gt;
    &lt;from&gt;^/(.*)&lt;/from&gt;
    &lt;to type=&quot;permanent-redirect&quot; last=&quot;true&quot;&gt;http://www.baidu.com/$1&lt;/to&gt;
&lt;/rule&gt;  
</code></pre><p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œä¸€åˆ‡éƒ½æ­£å¸¸ã€‚ä½†æ˜¯æˆ‘ç”¨è½¬å‘å´ä¸è¡Œã€‚</p><pre><code>&lt;rule&gt;
    &lt;from&gt;/products/([0-9]+)&lt;/from&gt;
    &lt;to&gt;/products/index.jsp?product_id=$1&lt;/to&gt;
&lt;/rule&gt;
</code></pre><p>è®¿é—®<code>localhost:8080/products/123</code>ä¸€ç›´æŠ¥<code>404</code>ï¼Œè€Œä¸”è¿˜æ˜¯ä¹±ç ã€‚</p><p>è¿™ä¸ªé—®é¢˜çº ç»“äº†å¥½ä¹…ã€‚<code>api</code>é‡Œä¹Ÿæ²¡çœ‹åˆ°å“ªé‡Œå‡ºé—®é¢˜äº†ã€‚æœ€åï¼Œç»ˆäºå‘ç°ï¼Œæ˜¯è½¬å‘åè¢«<code>struts</code>æ‹¦æˆªäº†ã€‚æ‰€ä»¥ï¼Œè¦ä¿®æ”¹<code>web.xml</code>ã€‚åœ¨<code>struts2</code>çš„<code>&lt;filter-mapping></code>é‡ŒåŠ ä¸Šï¼š</p><pre><code>&lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;  
&lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt; 
</code></pre><p>å°±å¯ä»¥äº†ã€‚æµªè´¹å¥½å¤šæ—¶é—´å»å¼„è¿™ä¸ªé—®é¢˜ï¼Œå›§~</p><p>å‚è€ƒï¼š</p><ul><li><a href=http://xlaohe1.iteye.com/blog/1130854>http://xlaohe1.iteye.com/blog/1130854</a></li><li><a href=http://fanzhongyun.iteye.com/blog/1221170>http://fanzhongyun.iteye.com/blog/1221170</a></li><li><a href=http://blog.csdn.net/ygf215/article/details/4766285>http://blog.csdn.net/ygf215/article/details/4766285</a></li><li><a href=http://nematodes.org/martin/2010/02/04/301-permanent-redirect-with-tomcat-howto/>http://nematodes.org/martin/2010/02/04/301-permanent-redirect-with-tomcat-howto/</a></li></ul></div><div class=post-copyright><p class=copyright-item><span class=item-title>æ–‡ç« ä½œè€…</span>
<span class=item-content>cirplan</span></p><p class=copyright-item><span class=item-title>ä¸Šæ¬¡æ›´æ–°</span>
<span class=item-content>2014-12-12</span></p><p class=copyright-item><span class=item-title>æ–‡ç« é“¾æ¥</span>
<span class=item-content><a rel=noopener href=https://cirplan.me/post/2014/12-12-java-urlrewritefilter/>https://cirplan.me/post/2014/12-12-java-urlrewritefilter/</a></span></p><p class=copyright-item><span class=item-title>è®¸å¯åè®®</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh target=_blank>ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™… (CC BY-NC-SA 4.0)</a></span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/java/>java</a>
<a href=/tags/urlrewritefilter/>urlrewritefilter</a></div><nav class=post-nav><a class=prev href=/post/2015/01-04-year-summary/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">2014å¹´å›é¡¾</span>
<span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span></a>
<a class=next href=/post/2014/12-08-css-selector/><span class="next-text nav-default">[è¯‘]cssé€‰æ‹©å™¨æ¸²æŸ“ä¼˜åŒ–</span>
<span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=copyright><span class=copyright-year>&copy;
2013 -
2022<span class=heart>ğŸ¥•</span><span>cirplan</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script>window.onload=function(){const e="fixed-open",n="slideout-open",s="icon-click",t=document.querySelector("#mobile-navbar-icon");t.addEventListener("click",o=>{const i=document.querySelector("#mobile-navbar"),a=document.querySelector("#mobile-panel");i.classList.contains(e)?(i.classList.remove(e),a.classList.remove(e),t.classList.remove(s),document.documentElement.classList.remove(n)):(i.classList.add(e),a.classList.add(e),t.classList.add(s),document.documentElement.classList.add(n))})}</script></body></html>