<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>jsä¹‹ajaxå­¦ä¹ ç¬”è®° - Cirplan</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="cirplan"><meta name=description content="jsä¹‹ajaxå­¦ä¹ ç¬”è®°"><meta name=keywords content="js,ajax"><link rel=canonical href=https://cirplan.github.io/post/2013/03-23-ajax-learn/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link href=/sass/main.min.4325dd250c3d3e29d579a819f16fd876adbc5a03b3a1b32d2eefe0a067e8f219.css rel=stylesheet><meta property="og:title" content="jsä¹‹ajaxå­¦ä¹ ç¬”è®°"><meta property="og:description" content="jsä¹‹ajaxå­¦ä¹ ç¬”è®°"><meta property="og:type" content="article"><meta property="og:url" content="https://cirplan.github.io/post/2013/03-23-ajax-learn/"><meta property="article:section" content="post"><meta property="article:published_time" content="2013-03-23T21:10:21+08:00"><meta property="article:modified_time" content="2013-03-23T21:10:21+08:00"><meta itemprop=name content="jsä¹‹ajaxå­¦ä¹ ç¬”è®°"><meta itemprop=description content="jsä¹‹ajaxå­¦ä¹ ç¬”è®°"><meta itemprop=datePublished content="2013-03-23T21:10:21+08:00"><meta itemprop=dateModified content="2013-03-23T21:10:21+08:00"><meta itemprop=wordCount content="1414"><meta itemprop=keywords content="js,ajax,"><meta name=twitter:card content="summary"><meta name=twitter:title content="jsä¹‹ajaxå­¦ä¹ ç¬”è®°"><meta name=twitter:description content="jsä¹‹ajaxå­¦ä¹ ç¬”è®°"></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Cirplan</a></div><div class=mobile-navbar-icon id=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>ä¸»é¡µ</li></a><a href=/post/><li class=mobile-menu-item>å½’æ¡£</li></a><a href=/tags/><li class=mobile-menu-item>æ ‡ç­¾</li></a><a href=/categories/><li class=mobile-menu-item>åˆ†ç±»</li></a><a href=/about/><li class=mobile-menu-item>å…³äº</li></a><a href=https://github.com/cirplan><li class=mobile-menu-item>Github</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Cirplan</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>ä¸»é¡µ</a></li><li class=menu-item><a class=menu-item-link href=/post/>å½’æ¡£</a></li><li class=menu-item><a class=menu-item-link href=/tags/>æ ‡ç­¾</a></li><li class=menu-item><a class=menu-item-link href=/categories/>åˆ†ç±»</a></li><li class=menu-item><a class=menu-item-link href=/about/>å…³äº</a></li><li class=menu-item><a class=menu-item-link href=https://github.com/cirplan>Github</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>jsä¹‹ajaxå­¦ä¹ ç¬”è®°</h1><div class=post-meta><span class=post-time>2013-03-23</span><div class=post-category><a href=/categories/js/>js</a></div><span class=more-meta>çº¦ 1414 å­—</span>
<span class=more-meta>é¢„è®¡é˜…è¯» 3 åˆ†é’Ÿ</span></div></header><div class=post-outdated><div class=warn><p>ã€æ³¨æ„ã€‘æœ€åæ›´æ–°äº <span class=timeago datetime=2013-03-23T21:10:21 title=2013-03-23>2013-03-23, </span>ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚</p></div></div><div class=post-content><h4 id=èµ·æº>èµ·æº:</h4><p>XHRåœ¨IE5ä¸­å¼•å…¥ï¼Œæ‰€ä»¥åœ¨IEä¸­å¯èƒ½ä¼šé‡åˆ°ä¸‰ç§ä¸åŒçš„ç‰ˆæœ¬ <code>MSXML2.XMLHttp.6.0</code>, <code>MSXML2.XMLHttp.3.0</code>ï¼Œ<code>MSXML2.XMLHttp</code>ã€‚</p><h4 id=ä¸€å»ºç«‹>ä¸€ã€å»ºç«‹</h4><pre><code>é€‚ç”¨äºIE7ä¹‹å‰çš„ç‰ˆæœ¬çš„åˆ›å»ºæ–¹å¼
//é€‚ç”¨äºIE7ä¹‹å‰çš„ç‰ˆæœ¬
function createXHR() {
	if ( typeof arguments.callee.activeXString != &quot;string&quot; ) {
		var versions = ['MSXML2.XMLHttp.6.0', 'MSXML2.XMLHttp.3.0','MSXML2.XMLHttp'],
			i, len;
		for ( i = 0, len = versions.length; i &lt; len; i++){
			try{
				new ActiveXObject( versions[i] );
				arguments.callee.activeXString = versions[i];
				break;
			}catch(ex){

			}
		}

	}
	return new ActiveXObject( arguments.callee.activeXString );
}
</code></pre><p>IE7+ã€Firefoxã€Operaã€Chrome and Safari éƒ½æ”¯æŒåŸç”ŸXHR</p><pre><code>//IE7+ã€Firefoxã€Operaã€Chrome and Safari éƒ½æ”¯æŒåŸç”ŸXHR
var xhr = new XMLHttpRequest();

æ‰€ä»¥å…¼å®¹å…¨éƒ¨æµè§ˆå™¨çš„æ–¹å¼æ˜¯
//æ‰€ä»¥å…¼å®¹å…¨éƒ¨æµè§ˆå™¨çš„å‡½æ•°ä¸º
function createXHR() {
	if ( typeof XMLHttpRequest != &quot;undefined&quot; ) {
		return new XMLHttpRequest();
	}else if ( typeof ActiveXObject != &quot;undefined&quot; ) {
		if ( typeof arguments.callee.activeXString != &quot;string&quot; ) {
		var versions = ['MSXML2.XMLHttp.6.0', 'MSXML2.XMLHttp.3.0','MSXML2.XMLHttp'],
			i, len;
		for ( i = 0, len = versions.length; i &lt; len; i++){
			try{
				new ActiveXObject( versions[i] );
				arguments.callee.activeXString = versions[i];
				break;
			}catch(ex){

			}
		}

	}
		return new ActiveXObject( arguments.callee.activeXString );
	} else {
		throw new Error(&quot;No XHR  object available.&quot;);
	} 
}
</code></pre><h4 id=äºŒxhrçš„ä½¿ç”¨>äºŒã€XHRçš„ä½¿ç”¨</h4><pre><code>1.OPEN()
//@param type(è¯·æ±‚ç±»å‹)  
//		 url(è¯·æ±‚URL-ç›¸å¯¹äºå½“å‰é¡µé¢ï¼Œä¹Ÿå¯ä»¥ç”¨ç»å¯¹è·¯å¾„)
//		 isAsync(æ˜¯å¦å¼‚æ­¥å‘é€)
//è°ƒç”¨openæ–¹æ³•ä¸ä¼šçœŸæ­£å‘é€è¯·æ±‚ï¼Œåªæ˜¯å¯åŠ¨ä¸€ä¸ªè¯·æ±‚ä»¥å¤‡å‘é€
xhr.open(&quot;get/post&quot;, &quot;example.php&quot;, false);
</code></pre><p>2.send()æ–¹æ³•</p><pre><code>@param body è¯·æ±‚çš„ä¸»ä½“å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè®¾ä¸ºnull
</code></pre><p>3.è¿”å›æ•°æ®</p><pre><code>responseText ä½œä¸ºå“åº”ä¸»ä½“è¢«è¿”å›æ–‡æœ¬
responseXML è‹¥å“åº”ç±»å‹ä¸º&quot;text/xml&quot;æˆ–&quot;application/xml&quot;,è¿™ä¸ªå±æ€§å°†ä¿å­˜åŒ…å«å“åº”   æ•°æ®çš„XML DOMæ–‡æ¡£
status å“åº”çš„HTTPçŠ¶æ€
statusText HTTPçŠ¶æ€çš„è¯´æ˜
</code></pre><p>5.å¼‚æ­¥å‘é€æ£€æµ‹çŠ¶æ€</p><pre><code>readyState
0 --æœªåˆå§‹åŒ–ï¼Œå°šæœªè°ƒç”¨open();
1 --å¯åŠ¨ï¼Œå·²ç»è°ƒç”¨open(),ä½†å°šæœªè°ƒç”¨send();
2 --å‘é€ï¼Œå·²ç»è°ƒç”¨send(),ä½†å°šæœªæ¥æ”¶åˆ°å“åº”;
3 --æ¥æ”¶ï¼Œå·²ç»æ¥æ”¶åˆ°éƒ¨åˆ†æ•°æ®;
4 --å®Œæˆï¼Œå·²ç»æ¥æ”¶åˆ°å…¨éƒ¨å“åº”æ•°æ®ï¼Œå¯ä»¥åœ¨å®¢æˆ·ç«¯ä½¿ç”¨;
å¿…é¡»åœ¨è°ƒç”¨open()ä¹‹å‰è°ƒç”¨readystatechangeäº‹ä»¶
xhr.onreadystatechange = function() {
	if( xhr.readyState == 4 ) {

	}
}
</code></pre><p>ä¸‰ã€HTTPå¤´ä¿¡æ¯</p><p>1.XHRé»˜è®¤è¯·æ±‚å¤´éƒ¨</p><pre><code>Accept: æµè§ˆå™¨èƒ½å¤Ÿå¤„ç†çš„å†…å®¹ç±»å‹
Accept-Charset: æµè§ˆå™¨èƒ½å¤Ÿæ˜¾ç¤ºçš„å­—ç¬¦é›†
Accept-Encoding: æµè§ˆå™¨èƒ½å¤Ÿå¤„ç†çš„å‹ç¼©ç¼–ç 
Accept-Language: æµè§ˆå™¨å½“å‰è®¾ç½®è¯­è¨€
Connection: æµè§ˆå™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„é“¾æ¥ç±»å‹
Cookie: å½“å‰é¡µé¢è®¾ç½®çš„ä»»ä½•Cookie
Host: å‘é€è¯·æ±‚é¡µé¢çš„æ‰€åœ¨åŸŸ
Referer: å‘é€è¯·æ±‚çš„é¡µé¢çš„URI
User-Agent: æµè§ˆå™¨çš„ç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²
</code></pre><p>2.è®¾ç½®å¤´éƒ¨</p><p>è°ƒç”¨<code>setRequestHeader()</code>æ–¹æ³•ï¼Œä¸¤ä¸ªå‚æ•°ï¼Œkey-valueå¿…é¡»åœ¨open()ä¹‹åï¼Œsend()ä¹‹å‰è°ƒç”¨æ³¨æ„ï¼Œæœ‰çš„æµè§ˆå™¨å…è®¸é‡å†™é»˜è®¤å¤´éƒ¨ï¼Œæœ‰çš„ä¸å…è®¸ï¼Œæ‰€ä»¥æœ€å¥½ä½¿ç”¨è‡ªå®šä¹‰å¤´éƒ¨å­—æ®µä¿¡æ¯ã€‚</p><p>3.è·å–å¤´éƒ¨å­—æ®µ</p><p>è°ƒç”¨<code>getResponseHeader()</code>ï¼Œå‚æ•° &ndash;å¤´éƒ¨å­—æ®µ<code>getAllResponseHeader()</code>; è·å–æ‰€æœ‰å¤´éƒ¨é•¿å­—ç¬¦ä¸²<code>getAllResponse-Headers()</code>; è¿”å›æ ¼å¼åŒ–çš„å¤šè¡Œæ–‡æœ¬ã€‚</p><p>4.getè¯·æ±‚</p><p>ç”¨äºæŸäº›è¯·æ±‚æ—¶ï¼ŒæŠŠæŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°è¿½åŠ åˆ°URLæœ«å°¾ï¼Œä½†å¿…é¡»ç»è¿‡<code>encodeURIComponent()</code>ç¼–ç </p><pre><code>/** è¿”å›ç»è¿‡encodeURIComponent()ç¼–ç çš„urlå‚æ•°
**@param url
*		 paramObj å‚æ•°å¯¹è±¡ key-value
*/
function addURLParam(url, paramObj){
	if ( typeof paramObj != &quot;object&quot; ) return url;
	var tag = ''''#'''';
	if ( url.indexOf(&quot;?&quot;) == &quot;-1&quot; ) tag = ''''?'''';
	for( var key in paramObj ){
		url += tag + encodeURIComponent( key ) + &quot;=&quot; + encodeURIComponent( paramObj[key] );
		if( tag != ''''#'''' ) tag = ''''#'''';
	}
	return url;
}

var url = ''''http://www.baidu.com''''; 
var paramObj = {&quot;key1&quot;:&quot;value1&quot;, &quot;key2&quot;:&quot;value2&quot;, &quot;key3&quot;:&quot;value3&quot;};
addURLParam( url , paramObj );// &quot;http://www.baidu.com?key1=value1#key2=value2#key3=value3&quot;

var url = ''''http://www.baidu.com''''; 
var paramObj = {&quot;key1&quot;:&quot;ss ss&quot;, &quot;key2&quot;:&quot;wqe2v&quot;, &quot;key3&quot;:&quot;sda/sa&quot;};
addURLParam( url , paramObj );//&quot;http://www.baidu.com?key1=ss%20ss#key2=wqe%02v#key3=sda%2Fsa&quot;
</code></pre><p>5.postè¯·æ±‚</p><p>æ¨¡ä»¿è¡¨å•æäº¤&ndash;è®¾ç½®<code>Content-Type</code> ä¸º <code>application/x-www-form-urlencoded</code>:</p><pre><code>var xhr = new XMLHttpRequest();
	xhr.onreadystatechange = function(){
	if ( xhr.readyState == 4 ){
	 		console.log( xhr.responseText );
		}
	};
	xhr.open(&quot;post&quot;, &quot;/hdzx/eventgetKTVEventList.action&quot;, true);
	xhr.setRequestHeader(&quot;Content-Type&quot;,&quot;application/x-www-form-urlencoded&quot;);
	xhr.send(&quot;id: 196, opt: 1, page:1&quot;);

// Accept:*/*
// Accept-Charset:GBK,utf-8;q=0.7,*;q=0.3
// Accept-Encoding:gzip,deflate,sdch
// Accept-Language:zh-CN,zh;q=0.8
// Connection:keep-alive
// Content-Length:19
// Content-Type:application/x-www-form-urlencoded
// Cookie:cityID=202; JSESSIONID=C5D1BFB15CD2425E873A6CB35D153B46
// Host:www.minifang.cn
// Origin:http://www.minifang.cn
// Referer:http://www.minifang.cn/ktv/196.html
// User-Agent:Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.33 (KHTML, like Gecko) Chrome/27.0.1438.7 Safari/537.33
</code></pre><p><code>æ³¨æ„ï¼šgetè¯·æ±‚çš„é€Ÿåº¦æœ€å¤šå¯è¾¾postè¯·æ±‚çš„ä¸¤å€</code></p></div><footer class=post-footer><div class=post-tags><a href=/tags/js/>js</a>
<a href=/tags/ajax/>ajax</a></div><nav class=post-nav><a class=prev href=/post/2013/12-22-life-rule/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">æ— è§„çŸ©ä¸æˆæ–¹åœ†</span>
<span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span></a>
<a class=next href=/post/2013/03-16-ie-inline-block/><span class="next-text nav-default">IE6/IE7ä¸‹ï¼šinline-blockè§£å†³æ–¹æ¡ˆ</span>
<span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=copyright><span class=copyright-year>&copy;
2013 -
2022<span class=heart>ğŸ¥•</span><span>cirplan</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script>window.onload=function(){const e="fixed-open",n="slideout-open",s="icon-click",t=document.querySelector("#mobile-navbar-icon");t.addEventListener("click",o=>{const i=document.querySelector("#mobile-navbar"),a=document.querySelector("#mobile-panel");i.classList.contains(e)?(i.classList.remove(e),a.classList.remove(e),t.classList.remove(s),document.documentElement.classList.remove(n)):(i.classList.add(e),a.classList.add(e),t.classList.add(s),document.documentElement.classList.add(n))})}</script></body></html>